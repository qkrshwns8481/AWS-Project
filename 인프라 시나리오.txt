시나리오

1. 서울 리전


2. VPC 하나 - VPC 호스트네임 활성화
  2-1) CIDR 10.0.0.0/16 Lab-VPC 


3. VPC에 연결할 인터넷 게이트 웨이(퍼블릭 서브넷이 여기로 라우팅)
  3-1) Lab-IGW >> Lab-VPC에 연결


4. 퍼블릭서브넷 - NATGATEWAY(앱서브넷 용), ALB > 앱서버에 웹접근 가능하도록, 퍼블릭서브넷에 자동IP할당
  4-1) CIDR 10.0.0.0/24 Lab-PublicSubnet1(가용영역 ap-northeast-2a)
  4-2) CIDR 10.0.0.1/24 Lab-PbulicSubnet2(가용영역 ap-northeast-2c)
  4-3) ALB 구현(대상그룹 프라이빗 서브넷에 앱서버 인스턴스 - 오토스케일링) - 
  


5. 프라이빗 서브넷 - 앱서버(인스턴스 - 오토 스케일링)
  5-1) CIDR 10.0.2.0/23 Lab-PrivateSubnet1(가용영역 ap-northeast-2a)
  5-2) CIDR 10.0.4.0/23 Lab-PrivateSubnet2(가용영역 ap-northeast-2c)
  5-3) 앱서버에 오토스케일링 구현(최소 2, 원하는거 2, 최대 4) - 대상추적으로(어떤 거 쓸지는 고민)
    5-3-1 > 대상추적 하는데 클라우드 경보 CPU 70이상으로 갔을 때 하나씩 추가 > 스트레스 툴 사용(후에), CPU사용률이
	   에이전트 필요하면 설치


6. 프라이빗 서브넷 - RDS(데이터베이스) - MultiAZ
 6-1) CIDR 10.0.6.0/23 Lab-PrivateSubnet3(가용영역 ap-northeast-2a)
 6-2) CIDR 10.0.8.0/23 Lab-PrivateSubnet4(가용영역 ap-northeast-2a)
 6-3) RDS는 MYSQL로 구현
 6-4) 쿼리는 모든 거 가져오기(?) - 추후에 결정


7. 정적웹사이트 S3(?)  > (구현 했을 시 클라우드프론트 해보기)
 7-1) 웹사이트는 어떻게(?)


8. Route 53을 이용해 S3오류났을 시 도쿄에 장애조치 라우팅
 8-1) 장애조치라우팅을 이용해서(클라우드 경보?)






--------------------------------- 만들면서 메모, 추가 구성(초안에 내용 반영함)-------------------------------------------


* 오토스케일링은 런치탬플릿으로 AMI이미지를 만들어야함 > 어떻게? (미리 만들어서 이미지 만들기)

보안그룹 -> 앱서버는 ALB에서 오는 HTTP허용
	    SSH는 키페어 만들어서(모든곳에서 허용) *******수정******* 필요한거 bastion host > 퍼블릭없음
	    RDS는 앱서버에서 오는 3306허용

라우팅 테이블은 동일영역 서브넷마다 한개(라우팅테이블 변경이 있을 시 변경을 용이하게 하기 위해서)
라우팅 테이블 3개(퍼블릭, 앱, 데이터베이스)

1차 - Network부분
이름 - VPC : Lab-VPC
        IGW : Lab-IGW
        PublicRouteTable : Lab-PublicRT1
        PrivateRouteTable : Lab-PrivateRT1(앱서브넷), Lab-PrivateRT2(데이터베이스)
        PublicSubnet : Lab-PublicSubnet1, Lab-PublicSubnet2

Use(태그) - Lab-PrivateSubnet1,2 : app-subnet1,2
	   Lab-PrivateSubnet3,4 : data-subnet1,2

퍼블릭서브넷 1  프라이빗 서브넷 1 프라이빗 서브넷 3 가용영역 첫번째
퍼블릭서브넷 2  프라이빗 서브넷 2 프라이빗 서브넷 4 가용영역 세번째

NAT게이트웨이 만들면 프라이빗에서 NAT로의 라우팅, 그리고 프라이빗 라우팅 테이블에 라우팅을 해줘야함
NAT게이트웨이 이름 Lab-NAT1, Lab-NAT2 >> NAT게이트웨이가 두개이기 때문에 프라이빗 라우팅 테이블도 각각 따로 사용해야함 

라우팅테이블 퍼블릭용 1개, 앱서버용(NAT때문에 2개), 데이터베이스용 1개 > 총 4개 만듬, 데이터베이스용 하나 빼고 다 라우팅 설정(인터넷게이트웨이 또는 NAT로의 라우팅)


앱.yaml만들 때 파라미터로 스택 사용가능한지 보기 
               

다중태그는 Tags:     이 형식으로
	   - Key: 
                 Value:
	   - Key:
	     Value:


1차 : Network 
NAT까지 생성함, 보안그룹 아직 생성안함 - 여기까지 문제없음



Appserver용 보안그룹을 만들려면 ELB를 미리 구현해야함

ELB 만들기 > V2로 해야 ALB로 생성 가능 > 서브넷은 퍼블릭 서브넷 2개, 보안그룹 ALBSG
	     리스너 : 어디로 들어오는지 정해줌, 그리고 타겟그룹도 설정함
	     타겟그룹 생성 > 헬스체크, 옵션으로 대상그룹 인스턴스가 시작됐을 때 60초 후부터 요청 받기로


여기서 만든 타겟그룹은 나중에 autoscailing 타겟그룹으로 쓸 것



yaml코드 나눠야 하는 거 network, app + ??
ALB는 어디로 가야 하나 싶지만 그래도 app으로 가는 게 나을 듯(보안그룹도 거기로)



Network템플릿에서 스택이름-VPC, 스택이름-Pbulic1, 스택이름-Public2 출력 지정
App에서 이 출력을 사용 > 파라미터를 사용해서 스택이름 입력 후 사용(!Sub 함수 사용)
			!Sub함수는 변수지정도 가능하고 매핑 + 변수지정 가능




2차 : Network부분은 완성(하지만 출력값 조정해야함)
       App부분 돌입(ALB하나 만들고 끝) - 속성값 찾는 데 오래걸림


로드밸런서 이름,보안 그룹 이름, 탄련적 주소 이름








